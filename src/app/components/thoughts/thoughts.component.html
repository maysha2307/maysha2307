<div class="thoughts-wrapper">
  <div class="board-head">
    <h2>Thoughts ğŸª¶</h2>
  </div>

  <!-- Notes Grid -->
  <div class="notes-grid">
    <!-- Note Card -->
    <div
      class="note"
      *ngFor="let note of thoughts$ | async; trackBy: trackById"
      [class.editing]="isEditing(note.id)"
      [class.active]="activeNoteId === note.id"
      (touchstart)="onNoteTouchStart($event, note.id)"
      (touchend)="onNoteTouchEnd($event)"
      (mousedown)="onNoteTouchStart($event, note.id)"
      (mouseup)="onNoteTouchEnd($event)"
      [style.transition]="'box-shadow 0.2s, transform 0.2s'"
    >
      <!-- Note body -->
      <div
        class="note-paper"
        [class.editing]="isEditing(note.id)"
    >
      <button class="note-heart-btn" [class.liked]="note.liked" (click)="toggleHeart(note, $event)" tabindex="0" aria-label="Like this thought">
        <span class="note-heart" [class.liked]="note.liked">&#10084;</span>
      </button>
        <pre *ngIf="!isEditing(note.id)" style="margin:0;background:none;border:none;font-family:'Dancing Script',cursive;font-size:1.18rem;line-height:1.7;text-indent:1.2em;white-space:pre-wrap;word-break:break-word;">
          {{ note.text }}
        </pre>
        <textarea *ngIf="isEditing(note.id)"
          class="note-textarea"
          [(ngModel)]="draftText[note.id!]"
          rows="5"
          style="width:100%;font-family:'Dancing Script',cursive;font-size:1.18rem;background:#fffbe9;border:none;outline:2px dashed rgba(236,64,122,0.7);border-radius:10px;resize:vertical;padding:8px 12px 12px 12px;box-sizing:border-box;"
        ></textarea>
      </div>

      <!-- Actions row -->
      <div class="note-actions">
  <button class="icon-btn" title="Edit" (click)="startEdit(note)">âœï¸</button>
  <button *ngIf="!isEditing(note.id)" class="icon-btn danger" title="Delete" (click)="deleteNote(note)">ğŸ—‘ï¸</button>
  <button *ngIf="isEditing(note.id)" class="icon-btn" title="Cancel" (click)="cancelEdit()">âœ–ï¸</button>
  <button class="icon-btn" title="Reply" (click)="toggleReply(note)" *ngIf="!isEditing(note.id)">ğŸ’¬</button>
  <span *ngIf="isEditing(note.id)" title="Save" (click)="saveEdit(note)" style="cursor:pointer;">ğŸ’¾</span>
      </div>

      <!-- Reply -->
  <div class="reply-paper" *ngIf="isReplyOpen(note.id)">
        <div style="display: flex; align-items: flex-start;">
          <div style="flex: 1;">
            <pre *ngIf="replyEditingId !== note.id" style="margin:0;background:none;border:none;font-family:'Dancing Script',cursive;font-size:1.05rem;line-height:1.6;white-space:pre-wrap;word-break:break-word;">
              {{ note.reply }}
            </pre>
            <textarea *ngIf="replyEditingId === note.id"
              class="reply-textarea"
              [(ngModel)]="draftReply[note.id!]"
              rows="3"
              style="width:100%;font-family:'Dancing Script',cursive;font-size:1.05rem;background:#fffbe9;border:none;outline:2px dashed rgba(236,64,122,0.7);border-radius:10px;resize:vertical;padding:8px 0px 8px 0px;box-sizing:border-box;"
            ></textarea>
          </div>
          <div style="display: flex; flex-direction: column; gap: 22px; margin-left: 10px; margin-top:6px">
            <button *ngIf="replyEditingId !== note.id" class="icon-btn" title="Edit reply" (click)="startReplyEdit(note)">âœï¸</button>
            <button *ngIf="replyEditingId !== note.id" class="icon-btn danger" title="Delete reply" (click)="deleteReply(note)">ğŸ—‘ï¸</button>
            <button *ngIf="replyEditingId === note.id" class="icon-btn save" title="Save reply" (click)="saveReply(note)">ğŸ’¾</button>
            <button *ngIf="replyEditingId === note.id" class="icon-btn" title="Cancel" (click)="cancelReplyEdit(note)">âœ–ï¸</button>
          </div>
          </div>
      </div>
    </div>
  </div>

  <!-- Add Button at bottom of notes grid -->
  <div class="add-btn-row">
    <button class="add-btn" (click)="addNote()" [disabled]="creating()">ï¼‹</button>
  </div>
</div>
